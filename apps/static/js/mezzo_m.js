!function(a,b,c){if(typeof define=='function')define(c);else b[a]=c()}('mezzo',this,function(){var J={};J.debug=true;J.promise=null;J.played=false;J.callback=null;J.adplay_version="gomtv-2.0";if(J.debug)console.log('[mezzo] AD-Play Module Start');var K={data:null,seq:"",movie_api_domain:"http://mtag.mman.kr/movie.mezzo",movie_icon_path:"http://advimg.ad-mapps.com/ad_images/",requestUrl:"",requestTimeout:1500,videoTimeout:3000,status:-1,mediaFileSrc:"",zindex:9999999,mode:'INJECTION',target:$(window),targetId:"",browserUrlBar:false,videoObj:null,isInIframe:false,overlayWindow:null,originalMedia:"",videoLoaded:false,hasSourceTag:false,playInitMode:"landscape",playMode:"landscape",bodyStyle:"",controls:false,code:{mWindowID:null,mAppID:null,mCategory:null,mCateName:"a_cate"},callback:{done:null,skip:null,adclick:null,back:null,etc:null,objhide:null,objshow:null}};function m_callback_exec(a){if(K.callback[a]){K.callback[a](K.status)}return 0}function m_callback_register(a){K.callback={done:null,skip:null,adclick:null,back:null,etc:null,objhide:null,objshow:null};var b=K.callback;var c=function(){return 0};for(var n in b){if(!b[n]){b[n]=c}}if(typeof a=="function"){b["skip"]=b["done"]=a}else{for(var n in b){b[n]=a[n]}}}J.setMezzoTargetId=function(a){if(J.debug)console.log('[mezzo] setMezzoTargetId');K.targetId=a};J.setMezzoVideoMode=function(a){if(J.debug)console.log('[mezzo] setMezzoVideoMode');K.mode=a};J.setView=function(a,b){t=$(b);m=(a?a:"").toUpperCase();if((m=="OVERLAY"||m=="INJECTION")&&t.size()>0){if(m=="INJECTION"&&t.get(0).nodeName=="VIDEO"){K.mode="INJECTION"}else{K.mode="OVERLAY"}K.target=t}else{K.mode="FULLSCREEN";K.target=$(window)}if(K.mode!=m){if(J.debug)console.log("[mezzo] 타겟 설정이 잘못되어 모드가 변경되었습니다.");if(J.debug)console.log("[mezzo] ["+m+"] → ["+K.mode+"]")}else{if(J.debug)console.log("[mezzo] ["+m+"] → ["+K.mode+"]")}};J.clear=function(){if(J.ended){J.ended("done")}};J.back=function(){if(J.ended){J.ended("back")}};J.request=function(C,D){if(J.debug)console.log('[mezzo] request');var E;var F=$.Deferred();J.promise=F.promise();K.status=1;m_callback_register(D);K.code.mWindowID=C.mWindowID;K.code.mAppID=C.mAppID;K.code.mCategory=C.mCategory;if(J.debug)console.log('[mezzo] _codes ↓↓↓');if(J.debug)console.log(C);if(navigator.userAgent.match(/iPhone|IEMobile/i)!==null){m_callback_exec("skip");return}var G=navigator.userAgent.match(/(?:(Android ))([^\\s;]+)/);if(G!=null&&G.length===3&&parseInt(G[2].charAt(0),10)<4){m_callback_exec("skip");return}var H=navigator.userAgent;var I=(navigator.userAgent.match("MSIE")||[]).length>0;if(I&&!H.match(/MSIE 1\d\.0/)){m_callback_exec("skip");return}if(J.played){m_callback_exec("skip");return}K.requestUrl=K.movie_api_domain+"/"+K.code.mWindowID+"/"+K.code.mAppID+"?"+K.code.mCateName+"="+K.code.mCategory;if(J.debug)console.log(K.requestUrl);$.ajax({url:K.requestUrl,dataType:"json",async:false,crossDomain:true,type:"GET",timeout:K.requestTimeout,error:function(a,b,c){if(b=="timeout"){if(J.debug)console.log("Ajax Timeout Error");F.reject(-4)}else if(b=="parsererror"){if(J.debug)console.log(c);if(J.debug)console.log("Ajax parser Error");F.reject(-6)}else{if(J.debug)console.log(a);if(J.debug)console.log("Ajax Error");F.reject(-5)}},success:function(a){try{if(J.debug)console.log(a);if(typeof(a.movie_api)=="undefined"||a.movie_api==""||typeof(a.click_api)=="undefined"||a.click_api==""||typeof(a.randing_url)=="undefined"||a.randing_url==""||typeof(a.imps_api)=="undefined"||a.imps_api==""||typeof(a.view_api)=="undefined"||a.view_api==""||typeof(a.sec_api)=="undefined"||a.sec_api==""||typeof(a.skip)=="undefined"){F.reject(-5)}else{F.resolve(a)}}catch(e){F.reject(-5)}}});J.promise.done(function(l){if(J.debug)console.log('[mezzo] Done');if(K.status>1){return}K.status=2;if(J.debug)console.log("[mezzo] mezzoInfo.targetId = "+K.targetId);if(J.debug)console.log("[mezzo] Display Mode = "+K.mode);if(K.targetId!=""){J.setView(K.mode,"#"+K.targetId)}K.seq=js_yyyy_mm_dd_hh_mm_ss();K.data=l;if(J.debug)console.log(K.data);var n=K.target.width();var o=Math.ceil(196*n/340);var p=null;K.mediaFileSrc=K.data.movie_api+n+"/"+o;switch(K.mode){case"FULLSCREEN":K.bodyStyle=$("BODY").attr("style")||"";p=$("<DIV id=\"__MEZZO_WRAP__\" style=\"position: absolute; top: 0px; left: -999px; z-index: "+K.zindex+";  \"><DIV id=\"__MEZZO_WRAP_VIDEO__\" style=\"display: table-cell; vertical-align: middle; z-index: "+(K.zindex+98)+"; background-color: #000\"><VIDEO id=\"__MEZZO_VIDEO__\" style=\"position: relative; background-color: #000; width: 100%\"></VIDEO></DIV><DIV id=\"__MEZZO_OVERLAY__\" style=\"position: absolute; z-index: "+(K.zindex+99)+"; display: none;\"><DIV></DIV></DIV></DIV>");break;case"OVERLAY":p=$("<DIV id=\"__MEZZO_WRAP__\" style=\"position: absolute; left: -999px; z-index: "+(K.zindex+99)+"\"><DIV id=\"__MEZZO_WRAP_VIDEO__\" style=\"width:100%; height:100%\"><VIDEO id=\"__MEZZO_VIDEO__\" style=\"width: 100%; height: 100%; background-color: #000\"></VIDEO></DIV><DIV id=\"__MEZZO_OVERLAY__\" style=\"position:absolute; z-index: "+(K.zindex+98)+"; display: none\"></DIV></DIV>");break;case"INJECTION":p=$("<DIV id=\"__MEZZO_WRAP__\" style=\"position: absolute; left: -999px; z-index: "+(K.zindex+98)+"\"><DIV id=\"__MEZZO_OVERLAY__\" style=\"position:absolute; z-index: "+(K.zindex+99)+"; display: none\"></DIV></DIV>");break}$("BODY").append(p);switch(K.mode){case"FULLSCREEN":p.not("A IMG").bind("touchmove",function(e){return false});K.videoObj=$("#__MEZZO_VIDEO__").get(0);break;case"OVERLAY":K.videoObj=$("#__MEZZO_VIDEO__").get(0);break;case"INJECTION":K.videoObj=$(K.target)[0];break}DisplayMode();if(K.isInIframe){K.overlayWindow=window.parent}else{K.overlayWindow=window}if(K.mode=="INJECTION"){K.hasSourceTag=false;if($(K.videoObj).find("source").length){K.hasSourceTag=true}if(J.debug)console.log("[mezzo] mezzoInfo.hasSourceTag : "+K.hasSourceTag);if(J.debug)console.log("[mezzo] mezzoInfo.videoObj.src : "+K.videoObj.src);if(K.hasSourceTag){K.originalMedia=$(K.videoObj).find("source")[0].src;K.videoObj.setAttribute("src",K.mediaFileSrc);$(K.videoObj).find("source").remove();m_callback_exec("objhide");$(K.videoObj).append('<source src="'+K.mediaFileSrc+'" type="video/mp4" />');if(J.debug)console.log("[mezzo] mezzoInfo.originalMedia : "+K.originalMedia)}else{K.originalMedia=K.videoObj.src;K.videoObj.src=K.mediaFileSrc}}else{K.videoObj.src=K.mediaFileSrc}if(J.debug)console.log("[mezzo] mezzoInfo.videoObj Check ↓↓↓");if(J.debug)console.log(K.videoObj);if(J.debug)console.log("[mezzo] mezzoInfo.originalMedia : "+K.originalMedia);function getOffsetSum(a){var b=0,left=0;while(a){b=b+parseInt(a.offsetTop);left=left+parseInt(a.offsetLeft);a=a.offsetParent}return{top:b,left:left}}function getOrientation(){var a=true;a=overlayWindow.innerWidth/overlayWindow.innerHeight<1.1;return a?"portrait":"landscape"}function js_yyyy_mm_dd_hh_mm_ss(){now=new Date();year=""+now.getFullYear();month=""+(now.getMonth()+1);if(month.length==1){month="0"+month}day=""+now.getDate();if(day.length==1){day="0"+day}hour=""+now.getHours();if(hour.length==1){hour="0"+hour}minute=""+now.getMinutes();if(minute.length==1){minute="0"+minute}second=""+now.getSeconds();if(second.length==1){second="0"+second}return year+""+month+""+day+""+hour+""+minute+""+second}var q=function(){if(J.debug)console.log('[mezzo] adRandingAction');K.overlayWindow.open(K.data.randing_url,'_blank')};function API_Call(a){var b=Math.random().toString();var c=b.substring(2,b.length);var d=new Image();d.src=a};function DisplayMode(){var a=K.target;var m=$(a);var w=$(window);var b=w.width();var c=w.height();if(b/c>1){if(J.debug)console.log("landscape");K.playInitMode='landscape'}else{if(J.debug)console.log("portrait");K.playInitMode='portrait'}};function onMezzoResize(){if(J.debug)console.log('[mezzo] onMezzoResize');var a=K.target;var b=a.get(0);var c=getOffsetSum(b).top;var m=$(a);var w=$(window);var d=m.outerWidth();var e=m.outerHeight();var f=w.width();var g=w.height();switch(K.mode){case"FULLSCREEN":$("BODY").scrollTop(0);$("#__MEZZO_WRAP__").css("left","0px");$("#__MEZZO_WRAP_VIDEO__").css({width:f,height:g});var v=$("#__MEZZO_VIDEO__");var h=0;var i=0;if(f/g>1){if(J.debug)console.log("landscape");K.playMode='landscape';$("#__MEZZO_VIDEO__, #__MEZZO_WRAP_VIDEO__, #__MEZZO_OVERLAY__").css({width:f,height:g,top:"0px",left:"0px"})}else{if(J.debug)console.log("portrait");K.playMode='portrait';$("#__MEZZO_VIDEO__").css({width:"100%",height:"initial"});h=v.width(),i=v.height();$("#__MEZZO_OVERLAY__").css({width:h,height:i}).offset(v.offset())}break;case"OVERLAY":case"INJECTION":$("#__MEZZO_WRAP__, #__MEZZO_OVERLAY__").css({width:d,height:e}).offset(m.offset());break}};var r=function(){if(J.debug)console.log('[mezzo] mezzoPlay');K.overlayWindow.$(window).bind("resize",onMezzoResize);API_Call(K.data.imps_api)};var s=function(){if(J.debug)console.log('[mezzo] mezzoPlayError')};var t=function(){if(J.debug)console.log('[mezzo] mezzoPlayEnd');B("done")};var u=function(){if(J.debug)console.log('[mezzo] mezzoPlayPause');if(J.debug)console.log(K.videoObj.ended);if(K.videoObj.duration>1&&K.videoObj.currentTime>1){if(K.videoObj.ended===false){B("etc")}}else{K.videoObj.play()}};var x=0,oldTime=-1;var y=false;var z=function(){x=parseInt(this.currentTime,10);if(!this.duration){return}if(this.currentTime>0&&this.currentTime<1&&$('#__MEZZO_OVERLAY__').css('display')=='none'){$("#__MEZZO_OVERLAY__").show();onMezzoResize();y=true}if(oldTime!==x){if(J.debug)console.log(x);if(J.debug)console.log(this.duration);oldTime=x;if(x==0||x%5==0){API_Call(K.data.qsec_api+"&sec="+x+"&s_key="+K.seq)}else{if(Math.floor(this.duration)==x){if(J.debug)console.log("마지막 쿼터");API_Call(K.data.qsec_api+"&sec="+Math.ceil(this.duration)+"&s_key="+K.seq)}}var a=$("#__MEZZO_OVERLAY__");var b=$(a).width();var c=$(a).height();if(J.debug)console.log("__MEZZO_WRAP__  videoWidth = "+b);if(J.debug)console.log("__MEZZO_WRAP__  videoHeight = "+c);if(!y)return;var d=0;var e=0;var f=null;K.overlayWindow.jQuery("#mezzo_click_icon").remove();switch(K.mode){case"FULLSCREEN":if(K.playMode=='landscape'){d=b/6;d=d.toFixed(0);e=c/6;e=e.toFixed(0);f=$("<img id='mezzo_click_icon' src='"+K.movie_icon_path+"btn_click.png' style='display:none; position:absolute; top: "+(c-e)+"px; left: 0px; width: "+d+"px; height: "+e+"px' >")}else{d=b/5;d=d.toFixed(0);e=c/5;e=e.toFixed(0);f=$("<img id='mezzo_click_icon' src='"+K.movie_icon_path+"btn_click.png' style='display:none; position:absolute; top: "+(c-e)+"px; left: 0px; width: "+d+"px; height: "+e+"px' >")}break;case"OVERLAY":d=b/6;d=d.toFixed(0);e=c/6;e=e.toFixed(0);f=$("<img id='mezzo_click_icon' src='"+K.movie_icon_path+"btn_click.png' style='display:none; position:absolute; top: "+(c-e)+"px; left: 0px; width: "+d+"px; height: "+e+"px' >");break;case"INJECTION":d=b/6;d=d.toFixed(0);e=c/6;e=e.toFixed(0);f=$("<img id='mezzo_click_icon' src='"+K.movie_icon_path+"btn_click.png' style='display:none; position:absolute; top: "+(c-e)+"px; left: 0px; width: "+d+"px; height: "+e+"px' >");break}K.overlayWindow.jQuery("#mezzo_click_icon").remove();K.overlayWindow.jQuery("#__MEZZO_OVERLAY__").append(f);K.overlayWindow.jQuery("#mezzo_click_icon").show();f.on("click",function(){API_Call(K.data.click_api+"&sec="+oldTime);API_Call(K.data.csec_api+"&sec="+oldTime);K.videoObj.pause();B("adclick");q()});if(K.data.skip>0){K.overlayWindow.jQuery("#mezzo_skip_icon").remove();if(oldTime>=K.data.skip){var g=0;var h=null;switch(K.mode){case"FULLSCREEN":if(K.playMode=='landscape'){g=b/9;g=g.toFixed(0);h=jQuery("<img id='mezzo_skip_icon' src='"+K.movie_icon_path+"btn_skip.png' style='display:none; position:absolute; top:"+(c-g)+"px; left:"+(b-g-10)+"px; width:"+g+"px; height:"+g+"px' >")}else{g=b/9;g=g.toFixed(0);h=jQuery("<img id='mezzo_skip_icon' src='"+K.movie_icon_path+"btn_skip.png' style='display:none; position:absolute; top:"+(c-g)+"px; left:"+(b-g-10)+"px; width:"+g+"px; height:"+g+"px' >")}break;case"OVERLAY":g=b/9;g=g.toFixed(0);h=jQuery("<img id='mezzo_skip_icon' src='"+K.movie_icon_path+"btn_skip.png' style='display:none; position:absolute; top:"+(c-g)+"px; left:"+(b-g-10)+"px; width:"+g+"px; height:"+g+"px' >");break;case"INJECTION":g=b/9;g=g.toFixed(0);h=jQuery("<img id='mezzo_skip_icon' src='"+K.movie_icon_path+"btn_skip.png' style='display:none; position:absolute; top:"+(c-g)+"px; left:"+(b-g-10)+"px; width:"+g+"px; height:"+g+"px' >");break}h.on("click",function(){K.videoObj.pause();B("skip")});K.overlayWindow.jQuery("#mezzo_skip_icon").remove();K.overlayWindow.jQuery("#__MEZZO_OVERLAY__").append(h);K.overlayWindow.jQuery("#mezzo_skip_icon").show()}else{var i=K.data.skip-oldTime;var g=0;var h=null;switch(K.mode){case"FULLSCREEN":if(K.playMode=='landscape'){g=b/9;g=g.toFixed(0);h=jQuery("<img id='mezzo_skip_icon' src='"+K.movie_icon_path+"count_"+i+".png' style='display:none; position:absolute; top:"+(c-g)+"px; left:"+(b-g-10)+"px; width:"+g+"px; height:"+g+"px' >")}else{g=b/9;g=g.toFixed(0);h=jQuery("<img id='mezzo_skip_icon' src='"+K.movie_icon_path+"count_"+i+".png' style='display:none; position:absolute; top:"+(c-g)+"px; left:"+(b-g-10)+"px; width:"+g+"px; height:"+g+"px' >")}break;case"OVERLAY":g=b/9;g=g.toFixed(0);h=jQuery("<img id='mezzo_skip_icon' src='"+K.movie_icon_path+"count_"+i+".png' style='display:none; position:absolute; top:"+(c-g)+"px; left:"+(b-g-10)+"px; width:"+g+"px; height:"+g+"px' >");break;case"INJECTION":g=b/9;g=g.toFixed(0);h=jQuery("<img id='mezzo_skip_icon' src='"+K.movie_icon_path+"count_"+i+".png' style='display:none; position:absolute; top:"+(c-g)+"px; left:"+(b-g-10)+"px; width:"+g+"px; height:"+g+"px' >");break}K.overlayWindow.jQuery("#mezzo_skip_icon").remove();K.overlayWindow.jQuery("#__MEZZO_OVERLAY__").append(h);K.overlayWindow.jQuery("#mezzo_skip_icon").show()}}K.overlayWindow.jQuery("#mezzo_logo_icon").remove();if(K.data.hd_icon!=""){var j=0;var k=null;j=b/6;j=j.toFixed(0);k=jQuery("<img id='mezzo_logo_icon' src='"+l.hd_icon+"' style='display:none; position: absolute; top: 5px; left : "+(b-j-10)+"px; width: "+j+"px'>");k.on("click",function(){API_Call(K.data.click_api+"&sec="+oldTime);API_Call(K.data.csec_api+"&sec="+oldTime);K.videoObj.pause();B("adclick");q()});K.overlayWindow.jQuery("#mezzo_logo_icon").remove();K.overlayWindow.jQuery("#__MEZZO_OVERLAY__").append(k);K.overlayWindow.jQuery("#mezzo_logo_icon").show()}}if(E){clearTimeout(E);E=setTimeout(A,K.videoTimeout)}if(parseInt(this.currentTime*10)/10>=parseInt(this.duration*10)/10){t()}};var A=function(){K.videoObj.pause();if(K.videoObj.currentTime==0){if(J.debug)console.log('[mezzo] timeoutVideoPlayCallback');K.videoObj.pause();B("skip")}};var B=function(a){K.status=4;J.played=true;K.videoObj.pause();K.overlayWindow.$(window).unbind("resize",onMezzoResize);clearTimeout(E);K.videoObj.removeEventListener('play',r,false);K.videoObj.removeEventListener('pause',u,false);K.videoObj.removeEventListener('timeupdate',z,false);K.videoObj.removeEventListener('error',s,false);switch(K.mode){case"FULLSCREEN":break;case"OVERLAY":break;case"INJECTION":var b=K.target;if(K.hasSourceTag){m_callback_exec("objshow");K.target.removeAttr("src");$(K.videoObj).find("source").remove();$(K.videoObj).append('<source src="'+K.originalMedia+'" type="video/mp4" />')}else{K.target.attr("src",K.originalMedia)}break}$("#__MEZZO_WRAP__").remove();m_callback_exec(a)};J.ended=B;x=parseInt(this.currentTime,10);K.videoObj.addEventListener('play',r,false);K.videoObj.addEventListener('pause',u,false);K.videoObj.addEventListener('timeupdate',z,false);K.videoObj.addEventListener('error',s,false);if(!K.videoLoaded){if(J.debug)console.log('[mezzo] VideoPlay');if(J.debug)console.log(K.videoObj);setTimeout(function(){K.videoObj.load();K.videoObj.play()},10);K.videoObj.load();K.videoObj.play();$(K.videoObj).attr("controls",false);if(E){clearTimeout(E)}E=setTimeout(A,K.videoTimeout)}}).fail(function(a){if(J.debug)console.log('[mezzo] Error');K.status=5;if(a==-1){if(J.debug)console.log('[mezzo] 재생 불가 브라우저')}else if(a==-2){if(J.debug)console.log('[mezzo] iOS 에서는 재생 불가')}else if(a==-3){if(J.debug)console.log('[mezzo] Android Version 4.0 이상 재생 가능')}else if(a==-4){if(J.debug)console.log('[mezzo] 광고 요청 타임아웃')}else if(a==-5){if(J.debug)console.log('[mezzo] 광고 요청 에러')}else if(a==-6){if(J.debug)console.log('[mezzo] 광고 없음')}J.played=true;m_callback_exec("skip")})};K.status=0;if(J.debug)console.log('[mezzo] AD-Play Module End');return J});